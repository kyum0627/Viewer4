using OpenTK.Graphics.OpenGL4;
using System.Diagnostics;
using System.Runtime.CompilerServices;

namespace IGX.ViewControl.Buffer.Common
{
    /// <summary>
    /// OpenGL은 GPU를 사용하며 근본적으로 Multi Processing을 수행하므로 디버깅이 너무 어렵고 힘들어서 만든 클래스
    /// 즉, OpenGL API 호출에서 오류가 발생했을 때 던져지는 사용자 정의 예외 클래스.
    /// 이는 일반적인 .NET 예외(`Exception`)를 상속하며, 발생한 OpenGL 오류 코드(`ErrorCode`)를 포하여 구체적인 진단 정보를 제공.
    /// </summary>
    public class GLStateException : Exception
    {
        /// <summary>
        /// 이 예외가 발생한 원인이 되는 OpenGL의 <see cref="ErrorCode"/>를 저장.
        /// 예: <see cref="ErrorCode.InvalidEnum"/>, <see cref="ErrorCode.InvalidValue"/> 등.
        /// </summary>
        public ErrorCode ErrorCode { get; }

        /// <summary>
        /// 지정된 OpenGL 오류 코드와 메시지로 <see cref="GLStateException"/>의 새 인스턴스를 초기화.
        /// </summary>
        /// <param name="errorCode">발생한 OpenGL 오류 코드.</param>
        /// <param name="message">예외를 설명하는 메시지.</param>
        public GLStateException(ErrorCode errorCode, string message) : base(message)
        {
            ErrorCode = errorCode;
        }

        /// <summary>
        /// 지정된 OpenGL 오류 코드, 메시지 및 내부 예외에 대한 참조를 사용하여
        /// <see cref="GLStateException"/>의 새 인스턴스를 초기화.
        /// </summary>
        /// <param name="errorCode">발생한 OpenGL 오류 코드.</param>
        /// <param name="message">예외를 설명하는 메시지.</param>
        /// <param name="innerException">현재 예외의 원인인 예외.
        /// 이 매개변수가 null이 아니면 현재 예외는 내부 예외를 처리하는 catch 블록에서 발생.</param>
        public GLStateException(ErrorCode errorCode, string message, Exception innerException) : base(message, innerException)
        {
            ErrorCode = errorCode;
        }

        // 아래의 생성자들은 기본 Exception 클래스의 생성자를 따르며,
        // OpenGL ErrorCode를 명시적으로 설정하지 않는 경우를 위해 오버로드.
        /// <summary>
        /// <see cref="GLStateException"/> 클래스의 새 인스턴스를 기본 속성으로 초기화.
        /// </summary>
        public GLStateException() : base()
        {
        }

        /// <summary>
        /// 지정된 메시지로 <see cref="GLStateException"/> 클래스의 새 인스턴스를 초기화.
        /// </summary>
        /// <param name="message">예외를 설명하는 메시지.</param>
        public GLStateException(string? message) : base(message)
        {
        }

        /// <summary>
        /// 지정된 메시지 및 내부 예외에 대한 참조로
        /// <see cref="GLStateException"/> 클래스의 새 인스턴스를 초기화.
        /// </summary>
        /// <param name="message">예외를 설명하는 메시지.</param>
        /// <param name="innerException">현재 예외의 원인인 예외.</param>
        public GLStateException(string? message, Exception? innerException) : base(message, innerException)
        {
        }
    }
}
