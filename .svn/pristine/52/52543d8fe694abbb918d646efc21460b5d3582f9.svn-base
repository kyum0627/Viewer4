using IGX.Geometry.Common;
using IGX.Geometry.DataStructure;
using IGX.Geometry.Tessellation;
using OpenTK.Mathematics;
using System.Collections.Generic;
namespace IGX.Geometry.GeometryBuilder
{
    public class Box : PrimitiveBase
    {
        #region
        public int GeometryID { get => InstanceData.GeometryID; set => InstanceData.GeometryID = value; }
        public float XLength { get; }
        public float YLength { get; }
        public float ZLength { get; }
        public SelectTo SelectionMode { get => InstanceData.SelectionMode; set => InstanceData.SelectionMode = value; }
        #endregion
        public Box(Matrix4 matrix, AABB3 bBoxLocal, float x = 1, float y = 1, float z = 1)
        {
            XLength = x;
            YLength = y;
            ZLength = z;
            Scale = new Vector3(XLength / 2, YLength / 2, ZLength / 2);
        }
        public override (List<Vector3> positions, List<Vector3> normals, List<uint> indices) Tessellate(uint n_seg, bool bBcap = true, bool bTcap = true)
        {
            float halfX = XLength * 0.5f;
            float halfY = YLength * 0.5f;
            float halfZ = ZLength * 0.5f;
            (Points, Normals, Indices) = TessellationUtility.SixFacetsVolume(
                -halfX, halfX, -halfY, halfY, -halfZ, halfZ, 0);
            if (Points != null && Normals != null)
            {
                (List<Vector3> Positions, List<Vector3> Normals) res = TessellationUtility.MatrixApply(
                    InstanceData.Model, Points, Normals);
                Points = res.Positions;
                Normals = res.Normals;
            }
            return (Points!, Normals!, Indices!);
        }
    }
}
